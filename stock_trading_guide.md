# 주식 자동매매 AI 개발 가이드
## 단일 종목 + 코스피 지수 분석 기반 전략

### 1. 프로젝트 개요

**목표**: TA-lib 기반 기술적 분석 지표(MACD, RSI, 볼린저밴드, 이동평균)를 활용하여 단일 종목과 코스피 지수를 함께 분석하는 자동매매 시스템 개발

**핵심 아이디어**: 개별 종목의 신호와 시장 전체 환경을 종합적으로 판단하여 매매 정확도와 위험 관리 효과 극대화

### 2. 핵심 분석 기능

#### 2.1 상대 강도 분석 (Relative Strength Analysis)
- **베타값 계산**: 종목이 코스피 대비 얼마나 민감하게 반응하는지 측정
- **상대 RSI 분석**: 개별 종목 RSI와 코스피 RSI 차이로 상대적 강세/약세 판단
- **MACD 다이버전스**: 종목과 시장의 MACD 신호가 다를 때 독립적 움직임 포착
- **상대 성과 비교**: 같은 기간 동안 종목 수익률 vs 코스피 수익률 비교

#### 2.2 시장 환경 필터링
- **시장 트렌드 판단**: 코스피 이동평균선 배열로 상승/하락/횡보 구분
- **시장 과열도 체크**: 코스피 RSI 70 이상 시 개별 종목 매수 신호 억제
- **변동성 환경 분석**: 코스피 볼린저밴드 폭으로 변동성 큰 구간 식별
- **거래량 분석**: 코스피 거래량 증가/감소 패턴으로 시장 참여도 측정

#### 2.3 시장 타이밍 최적화
- **이중 확인 시스템**: 코스피와 개별 종목 모두 매수 신호 시 진입
- **조기 경고 시스템**: 코스피 신호 변화로 개별 종목 포지션 조정
- **섹터 로테이션 감지**: 코스피 대비 종목 성과로 업종별 강세 순환 파악

### 3. 전략 개발 단계

#### 3.1 1단계: 기본 전략 (베이스라인)
**구성 요소**:
- 개별 종목 MACD, RSI, 볼린저밴드, 이동평균만 사용
- 단순한 매수/매도 신호 생성
- 고정된 손절매/익절매 수준

**목표**: 기본 성과 기준점 설정

#### 3.2 2단계: 시장 환경 필터 추가
**구성 요소**:
- 기본 전략 + 코스피 트렌드 필터
- 시장 상승 환경에서만 매수 허용
- 시장 과열 시 매수 신호 억제

**기대 효과**: 시장 하락기 손실 최소화

#### 3.3 3단계: 상대 강도 분석 추가
**구성 요소**:
- 2단계 전략 + 상대 강도 분석
- 종목이 시장 대비 강세일 때만 매수
- 상대 약세 시 조기 매도 고려

**기대 효과**: 종목 선택 정확도 향상

#### 3.4 4단계: 변동성 조정 추가
**구성 요소**:
- 3단계 전략 + 동적 포지션 크기 조정
- 시장 변동성에 따른 손절매 수준 조정
- 변동성 큰 시기 포지션 크기 축소

**기대 효과**: 위험 조정 수익률 개선

### 4. A/B 테스트 설계

#### 4.1 테스트 전략 구성
1. **베이스라인**: 개별 종목만 사용한 단순 전략
2. **변형 1**: 베이스라인 + 시장 환경 필터
3. **변형 2**: 베이스라인 + 상대 강도 분석
4. **변형 3**: 베이스라인 + 변동성 조정
5. **변형 4**: 모든 요소 통합

#### 4.2 성과 지표별 평가
- **수익률**: 어떤 조합이 가장 높은 수익을 내는가?
- **샤프 비율**: 위험 대비 수익은?
- **최대 손실**: 리스크 관리 효과는?
- **승률**: 매매 성공률 개선 효과는?
- **거래 빈도**: 매매 기회 감소 정도는?

#### 4.3 테스트 환경 설정
- **기간**: 최소 2년 이상, 다양한 시장 환경 포함
- **종목**: 대형주, 중소형주, 업종별 대표 종목 각각 테스트
- **시장 상황**: 상승장/하락장/횡보장 각각에서의 성과 분석
- **데이터 분할**: 학습/검증/테스트 데이터 분리

### 5. 위험 관리 시스템

#### 5.1 포지션 크기 관리
- **기본 원칙**: 단일 종목 최대 10% 이하
- **변동성 조정**: 시장 변동성 높을 때 포지션 크기 축소
- **상관관계 고려**: 유사 업종 종목 간 분산 투자

#### 5.2 손절매 시스템
- **고정 손절매**: 매수가 대비 5% 하락 시
- **변동성 기반 손절매**: 시장 변동성에 따라 2-8% 범위 조정
- **시장 환경 기반**: 시장 급락 시 전체 포지션 정리

#### 5.3 익절매 전략
- **부분 익절**: 20% 상승 시 50% 물량 매도
- **트레일링 스톱**: 고점 대비 일정 비율 하락 시 매도
- **시장 신호 기반**: 시장 과열 신호 시 조기 익절

### 6. 백테스팅 프레임워크

#### 6.1 데이터 준비
- **일봉 데이터**: 개별 종목 + 코스피 지수 최소 3년치
- **지표 계산**: TA-lib 활용한 모든 기술적 지표
- **데이터 검증**: 액면분할, 배당 등 이벤트 조정

#### 6.2 백테스팅 실행
- **거래 비용 반영**: 수수료, 세금, 슬리피지 포함
- **유동성 고려**: 일일 거래량 대비 포지션 크기 제한
- **실행 지연**: 신호 발생 후 실제 체결까지 지연시간 반영

#### 6.3 성과 분석
- **월별/연도별 수익률 분석**
- **업종별/시장 상황별 성과 비교**
- **최대 연속 손실 기간 분석**
- **변동성 조정 성과 지표 계산**

### 7. 실행 가이드

#### 7.1 개발 우선순위
1. **데이터 수집 시스템** 구축
2. **지표 계산 엔진** 개발
3. **기본 전략** 구현 및 테스트
4. **시장 환경 필터** 추가
5. **상대 강도 분석** 통합
6. **변동성 조정** 시스템 구현
7. **종합 백테스팅** 및 최적화

#### 7.2 성과 검증 방법
- **전진 분석**: 과거 데이터로 학습, 미래 데이터로 검증
- **교차 검증**: 다양한 기간/종목으로 반복 테스트
- **강건성 테스트**: 파라미터 변경에 대한 민감도 분석
- **실제 거래 시뮬레이션**: 소액으로 실전 테스트

#### 7.3 권장 접근법
**단계별 구현 → 개별 테스트 → 조합 테스트** 순서로 진행하세요. 각 단계에서 백테스팅 결과를 문서화하고, 실제 성과 개선이 있는 요소만 다음 단계에 포함시키는 것이 가장 효율적입니다.

특히 라이브 트레이딩에서는 **단순하고 검증된 전략**이 복잡한 전략보다 더 좋은 결과를 내는 경우가 많습니다.

### 8. 주의사항

#### 8.1 오버피팅 방지
- **과도한 최적화 금지**: 파라미터 조정으로 과거 성과만 좋게 만들지 않기
- **복잡도 제한**: 조건이 너무 많으면 실전에서 작동하지 않을 수 있음
- **아웃 오브 샘플 테스트**: 학습에 사용하지 않은 데이터로 최종 검증

#### 8.2 실전 적용 시 고려사항
- **시장 미시구조**: 호가 스프레드, 거래량, 체결 지연 등
- **시스템 안정성**: 데이터 오류, 네트워크 장애 대응
- **감정적 요소**: 연속 손실 시 시스템 신뢰도 유지

#### 8.3 지속적 개선 방향
- **성과 모니터링**: 월간/분기별 성과 리뷰
- **시장 환경 변화 대응**: 새로운 시장 패턴 반영
- **전략 업데이트**: 검증된 개선 사항만 단계적 적용