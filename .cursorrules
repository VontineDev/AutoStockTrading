# í‚¤ì›€ API ì•Œê³ ë¦¬ì¦˜ ë§¤ë§¤ í”„ë¡œê·¸ëž¨ ê°œë°œ ê·œì¹™

## ðŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”
- Python 3.13 ê¸°ë°˜ TA-Lib í™œìš© ìŠ¤ìœ™ íŠ¸ë ˆì´ë”©
- pykrxë¥¼ í†µí•œ ë°ì´í„° ìˆ˜ì§‘ + í‚¤ì›€ API ì‹¤ì‹œê°„ ì—°ë™
- Streamlitì„ ì´ìš©í•œ ì›¹ UI ê°œë°œ  
- 2ì£¼ ì™„ì„± ëª©í‘œì˜ 1ì¸ ê°œë°œ í”„ë¡œì íŠ¸
- 100ë§Œì› ê·œëª¨ ìŠ¤ìœ™ íŠ¸ë ˆì´ë”©ì— ìµœì í™”

## ðŸ› ï¸ ê°œë°œ í™˜ê²½ ê´€ë¦¬

### í„°ë¯¸ë„ ëª…ë ¹ì–´ ì²˜ë¦¬ ì›ì¹™ (CRITICAL RULE)

#### ìš´ì˜ì²´ì œ ê°ì§€ ë° ì ì ˆí•œ ëª…ë ¹ì–´ ì‚¬ìš©
- **ìš´ì˜ì²´ì œ í™•ì¸ í•„ìˆ˜**: í„°ë¯¸ë„ ëª…ë ¹ì–´ ì‹¤í–‰ ì „ ë°˜ë“œì‹œ ìš´ì˜ì²´ì œë¥¼ ê°ì§€í•˜ê³  í•´ë‹¹ OSì— ë§žëŠ” ëª…ë ¹ì–´ ì‚¬ìš©
- **ëª…ë ¹ì–´ ê²½ë¡œ ì°¨ì´ ì¸ì‹**: Windowsì™€ Unix ê³„ì—´ ì‹œìŠ¤í…œì˜ ëª…ë ¹ì–´ ê²½ë¡œ ë° êµ¬ë¬¸ ì°¨ì´ ê³ ë ¤
- **ê°€ìƒí™˜ê²½ í™œì„±í™”**: OSë³„ ê°€ìƒí™˜ê²½ í™œì„±í™” ëª…ë ¹ì–´ êµ¬ë¶„

#### OSë³„ í•µì‹¬ ëª…ë ¹ì–´ ì°¨ì´ì 
```python
import platform
import os

def get_os_commands():
    """ìš´ì˜ì²´ì œë³„ ëª…ë ¹ì–´ ë”•ì…”ë„ˆë¦¬ ë°˜í™˜"""
    system = platform.system().lower()
    
    if system == "windows":
        return {
            'python': 'python',
            'pip': 'pip',
            'venv_activate': '.\\venv\\Scripts\\activate',
            'venv_create': 'python -m venv venv',
            'path_separator': '\\',
            'clear': 'cls',
            'list_dir': 'dir',
            'shell': 'powershell'
        }
    elif system in ["linux", "darwin"]:  # Linux or macOS
        return {
            'python': 'python3',
            'pip': 'pip3',
            'venv_activate': 'source venv/bin/activate',
            'venv_create': 'python3 -m venv venv',
            'path_separator': '/',
            'clear': 'clear',
            'list_dir': 'ls -la',
            'shell': 'bash'
        }

# ì‚¬ìš© ì˜ˆì‹œ
commands = get_os_commands()
print(f"ê°€ìƒí™˜ê²½ í™œì„±í™”: {commands['venv_activate']}")
```

#### í„°ë¯¸ë„ ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ í•„ìˆ˜ ì²´í¬ì‚¬í•­
1. **OS ê°ì§€**: `platform.system()` ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ë¡œ ìš´ì˜ì²´ì œ í™•ì¸
2. **Python ì‹¤í–‰íŒŒì¼**: Windows(python), Linux/macOS(python3)
3. **ê°€ìƒí™˜ê²½ ê²½ë¡œ**: Windows(Scripts), Linux/macOS(bin)
4. **ê²½ë¡œ êµ¬ë¶„ìž**: Windows(\\), Linux/macOS(/)
5. **ì…¸ íƒ€ìž…**: Windows(PowerShell/CMD), Linux/macOS(Bash/Zsh)

## ðŸ’» ì½”ë“œ í’ˆì§ˆ ì›ì¹™

### ê°€ë…ì„± ìš°ì„  (Readability First)
- **ëª…í™•í•œ ë„¤ì´ë°**: ì˜ë¯¸ ìžˆëŠ” ë³€ìˆ˜ëª…, í•¨ìˆ˜ëª…, í´ëž˜ìŠ¤ëª… ì‚¬ìš©
  - í´ëž˜ìŠ¤: PascalCase (ì˜ˆ: `KiwoomApiClient`, `TradingStrategy`)
  - í•¨ìˆ˜/ë³€ìˆ˜: snake_case (ì˜ˆ: `get_stock_price`, `current_price`)
  - ìƒìˆ˜: UPPER_SNAKE_CASE (ì˜ˆ: `MAX_RETRY_COUNT`, `API_TIMEOUT`)
  - íŒŒì¼ëª…: snake_case (ì˜ˆ: `kiwoom_client.py`, `trading_strategy.py`)
- **ì£¼ì„ê³¼ ë¬¸ì„œí™”**: ë³µìž¡í•œ ë¡œì§ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì— ëª…í™•í•œ ì£¼ì„ ì¶”ê°€
- **ì¼ê´€ëœ ì½”ë”© ìŠ¤íƒ€ì¼**: í”„ë¡œì íŠ¸ ì „ë°˜ì— ê±¸ì³ ì¼ê´€ì„± ìœ ì§€

### ê°„ê²°ì„±ê³¼ ëª…í™•ì„± (Simplicity & Clarity)
- **KISS ì›ì¹™**: Keep It Simple, Stupid - ë¶ˆí•„ìš”í•œ ë³µìž¡ì„± ì œê±°
- **DRY ì›ì¹™**: Don't Repeat Yourself - ì¤‘ë³µ ì½”ë“œ ì œê±° ë° ìž¬ì‚¬ìš© ê°€ëŠ¥í•œ í•¨ìˆ˜/í´ëž˜ìŠ¤ ì„¤ê³„
- **ë‹¨ì¼ ì±…ìž„ ì›ì¹™**: í•˜ë‚˜ì˜ í•¨ìˆ˜/í´ëž˜ìŠ¤ëŠ” í•˜ë‚˜ì˜ ëª…í™•í•œ ì±…ìž„ë§Œ ê°€ì§

### íƒ€ìž… ížŒíŠ¸ í•„ìˆ˜
```python
from typing import Dict, List, Optional, Union, Tuple
import pandas as pd

def calculate_rsi(prices: pd.Series, period: int = 14) -> pd.Series:
    """RSI ê³„ì‚° í•¨ìˆ˜"""
    pass

def get_stock_data(symbol: str, start_date: str) -> Optional[pd.DataFrame]:
    """ì£¼ì‹ ë°ì´í„° ì¡°íšŒ"""
    pass
```

## ðŸ—ï¸ ì„¤ê³„ ì›ì¹™

### SOLID ì›ì¹™ ì ìš©
- **Single Responsibility**: ê° í´ëž˜ìŠ¤ëŠ” í•˜ë‚˜ì˜ ëª…í™•í•œ ì±…ìž„
- **Open/Closed**: í™•ìž¥ì—ëŠ” ì—´ë ¤ìžˆê³  ìˆ˜ì •ì—ëŠ” ë‹«í˜€ìžˆëŠ” ì„¤ê³„
- **Liskov Substitution**: ìƒì† ê´€ê³„ì—ì„œ ê¸°ë³¸ í´ëž˜ìŠ¤ ëŒ€ì²´ ê°€ëŠ¥
- **Interface Segregation**: ìµœì†Œí•œì˜ ì¸í„°íŽ˜ì´ìŠ¤ ë¶„ë¦¬
- **Dependency Inversion**: ì¶”ìƒí™”ì— ì˜ì¡´, êµ¬ì²´ êµ¬í˜„ì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ

### ëª¨ë“ˆí™”ì™€ ê³„ì¸µ êµ¬ì¡°
```python
# ì˜ˆì‹œ: ì „ëžµ ê¸°ë³¸ í´ëž˜ìŠ¤
from abc import ABC, abstractmethod

class BaseStrategy(ABC):
    @abstractmethod
    def generate_signals(self, data: pd.DataFrame) -> pd.Series:
        """ë§¤ë§¤ ì‹ í˜¸ ìƒì„±"""
        pass
    
    @abstractmethod
    def calculate_position_size(self, signal: int, portfolio_value: float) -> float:
        """í¬ì§€ì…˜ í¬ê¸° ê³„ì‚°"""
        pass
```

## ðŸ“ˆ TA-Lib ê¸°ë°˜ ê°œë°œ ì›ì¹™

### ì§€í‘œ êµ¬í˜„ ìš°ì„ ìˆœìœ„
1. **ì§ì ‘ êµ¬í˜„ ê¸ˆì§€**: ë³µìž¡í•œ ê¸°ìˆ ì  ì§€í‘œëŠ” TA-Lib ì‚¬ìš©
2. **OHLCV ë°ì´í„°**: 95% ì´ìƒì˜ ì§€í‘œê°€ OHLCVë¡œ ê³„ì‚° ê°€ëŠ¥
3. **ê²€ì¦ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬**: TA-Libì€ ì—…ê³„ í‘œì¤€ ê¸°ìˆ ì  ë¶„ì„ ë„êµ¬
4. **ë§¤ê°œë³€ìˆ˜ ìµœì í™”**: ë°±í…ŒìŠ¤íŒ…ì„ í†µí•œ ì§€í‘œ íŒŒë¼ë¯¸í„° íŠœë‹

### ìŠ¤ìœ™ íŠ¸ë ˆì´ë”© ê¶Œìž¥ ì„¤ì •
```python
# í‘œì¤€ ë§¤ê°œë³€ìˆ˜ (ìŠ¤ìœ™ íŠ¸ë ˆì´ë”©ìš©)
SWING_PARAMS = {
    'RSI': {'period': 14, 'oversold': 30, 'overbought': 70},
    'MACD': {'fast': 12, 'slow': 26, 'signal': 9},
    'BB': {'period': 20, 'deviation': 2.0},
    'STOCH': {'k_period': 14, 'd_period': 3},
    'ATR': {'period': 14}
}
```

## ðŸ“Š ë°ì´í„° ì²˜ë¦¬ ì›ì¹™

### pykrx ê¸°ë°˜ ë°ì´í„° ìˆ˜ì§‘
```python
import pykrx.stock as stock
from datetime import datetime, timedelta

def collect_stock_data(symbol: str, days: int = 500) -> pd.DataFrame:
    """pykrxë¥¼ ì´ìš©í•œ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘"""
    end_date = datetime.now().strftime('%Y%m%d')
    start_date = (datetime.now() - timedelta(days=days)).strftime('%Y%m%d')
    
    try:
        data = stock.get_market_ohlcv_by_date(start_date, end_date, symbol)
        return data
    except Exception as e:
        logging.error(f"ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨ {symbol}: {e}")
        return pd.DataFrame()
```

## ðŸ”’ ë³´ì•ˆ ë° í™˜ê²½ ê´€ë¦¬

### API í‚¤ ë° ë¯¼ê°ì •ë³´ ê´€ë¦¬ (ì ˆëŒ€ ì¤€ìˆ˜)
```python
import os
from dotenv import load_dotenv

load_dotenv()

# ì˜¬ë°”ë¥¸ ë°©ë²•
API_KEY = os.getenv('KIWOOM_API_KEY')
ACCOUNT_NUMBER = os.getenv('TRADING_ACCOUNT')

# ê¸ˆì§€: í•˜ë“œì½”ë”©
# API_KEY = "your_api_key_here"  # ì ˆëŒ€ ê¸ˆì§€!
```

### ìž…ë ¥ ê²€ì¦ê³¼ ìµœì†Œ ê¶Œí•œ
- **ëª¨ë“  ì‚¬ìš©ìž ìž…ë ¥ ê²€ì¦**: ì¢…ëª© ì½”ë“œ, ë‚ ì§œ, ìˆ˜ëŸ‰ ë“± ìœ íš¨ì„± ê²€ì‚¬
- **SQL ì¸ì ì…˜ ë°©ì§€**: ë§¤ê°œë³€ìˆ˜í™”ëœ ì¿¼ë¦¬ ì‚¬ìš©
- **í™˜ê²½ë³€ìˆ˜ ë¶„ë¦¬**: .env íŒŒì¼ ì‚¬ìš©, .gitignoreì— í¬í•¨

## âš ï¸ ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹… ì›ì¹™

### ì²´ê³„ì ì¸ ì˜ˆì™¸ ì²˜ë¦¬
```python
import logging
import requests
from typing import Optional

def fetch_stock_data(symbol: str) -> Optional[pd.DataFrame]:
    """ì£¼ì‹ ë°ì´í„° ì¡°íšŒ with ì—ëŸ¬ ì²˜ë¦¬"""
    max_retries = 3
    
    for attempt in range(max_retries):
        try:
            # API í˜¸ì¶œ
            response = requests.get(f"/api/stocks/{symbol}", timeout=10)
            response.raise_for_status()
            return pd.DataFrame(response.json())
            
        except requests.exceptions.ConnectionError as e:
            logging.warning(f"ì—°ê²° ì˜¤ë¥˜ (ì‹œë„ {attempt + 1}/{max_retries}): {e}")
        except requests.exceptions.Timeout as e:
            logging.warning(f"íƒ€ìž„ì•„ì›ƒ (ì‹œë„ {attempt + 1}/{max_retries}): {e}")
        except requests.exceptions.RequestException as e:
            logging.error(f"API ì˜¤ë¥˜: {e}")
            break
        except Exception as e:
            logging.error(f"ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜: {e}")
            break
    
    return None
```

### ë¡œê¹… ì‹œìŠ¤í…œ ì„¤ì •
```python
import logging
from datetime import datetime

# ë¡œê¹… ì„¤ì •
def setup_logging():
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        handlers=[
            logging.FileHandler(f'logs/trading_{datetime.now().strftime("%Y%m%d")}.log', encoding='utf-8'),
            logging.StreamHandler()
        ]
    )

# print() ì‚¬ìš© ê¸ˆì§€, logging ì‚¬ìš©
logger = logging.getLogger(__name__)
logger.info("í”„ë¡œê·¸ëž¨ ì‹œìž‘")
logger.warning("ê²½ê³  ë©”ì‹œì§€")
logger.error("ì˜¤ë¥˜ ë°œìƒ")
```

## ðŸ§ª í…ŒìŠ¤íŠ¸ ì›ì¹™

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ìž‘ì„±
```python
import unittest
import pandas as pd
from src.strategies.rsi_strategy import RSIStrategy

class TestRSIStrategy(unittest.TestCase):
    def setUp(self):
        self.strategy = RSIStrategy()
        self.sample_data = pd.DataFrame({
            'close': [100, 102, 101, 103, 105, 104, 106]
        })
    
    def test_rsi_calculation(self):
        """RSI ê³„ì‚° í…ŒìŠ¤íŠ¸"""
        signals = self.strategy.generate_signals(self.sample_data)
        self.assertIsInstance(signals, pd.Series)
        self.assertEqual(len(signals), len(self.sample_data))
    
    def test_boundary_conditions(self):
        """ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸"""
        # ë¹ˆ ë°ì´í„°
        empty_data = pd.DataFrame()
        with self.assertRaises(ValueError):
            self.strategy.generate_signals(empty_data)
```

### ë°±í…ŒìŠ¤íŒ… ê²€ì¦
- **ì•„ì›ƒì˜¤ë¸Œìƒ˜í”Œ í…ŒìŠ¤íŠ¸**: ì „ì²´ ë°ì´í„°ì˜ 20-30% ê²€ì¦ìš©ìœ¼ë¡œ ë¶„ë¦¬
- **ê³¼ì í•© ë°©ì§€**: ë‹¨ìˆœí•œ ì „ëžµ ì„ í˜¸, ë§¤ê°œë³€ìˆ˜ ê³¼ë„í•œ ìµœì í™” ê¸ˆì§€
- **ì„±ê³¼ ì§€í‘œ**: ìˆ˜ìµë¥ , ìƒ¤í”„ ë¹„ìœ¨, ìµœëŒ€ ë‚™í­(MDD) ì¢…í•© í‰ê°€

## âš¡ ì„±ëŠ¥ ìµœì í™” ì›ì¹™

### íš¨ìœ¨ì ì¸ ìžë£Œêµ¬ì¡°ì™€ ì•Œê³ ë¦¬ì¦˜
- **pandas ìµœì í™”**: vectorized ì—°ì‚° ì‚¬ìš©, apply() ëŒ€ì‹  ë‚´ìž¥ í•¨ìˆ˜ í™œìš©
- **TA-Lib í™œìš©**: ë³µìž¡í•œ ê¸°ìˆ ì  ì§€í‘œëŠ” ì§ì ‘ êµ¬í˜„í•˜ì§€ ë§ê³  TA-Lib ì‚¬ìš©
- **ë©”ëª¨ë¦¬ ê´€ë¦¬**: ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ ì²­í¬ ë‹¨ìœ„ ì²˜ë¦¬ ë° ë©”ëª¨ë¦¬ í•´ì œ

### ìºì‹±ê³¼ ìµœì í™”
```python
from functools import lru_cache
import sqlite3

@lru_cache(maxsize=128)
def get_stock_info(symbol: str) -> Dict:
    """ì¢…ëª© ì •ë³´ ìºì‹±"""
    pass

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ë§
class DatabaseManager:
    def __init__(self):
        self.connection_pool = {}
```

## ðŸ’¼ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì›ì¹™

### 100ë§Œì› ê·œëª¨ í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬
```python
class RiskManager:
    def __init__(self, total_capital: float = 1_000_000):
        self.total_capital = total_capital
        self.max_stocks = 5  # ìµœëŒ€ 5ì¢…ëª© ë¶„ì‚°íˆ¬ìž
        self.max_position_size = 0.25  # ì¢…ëª©ë‹¹ ìµœëŒ€ 25%
        self.stop_loss_percent = 0.03  # 3% ì†ì ˆë§¤
    
    def calculate_position_size(self, stock_price: float) -> int:
        """ì•ˆì „í•œ í¬ì§€ì…˜ í¬ê¸° ê³„ì‚°"""
        max_investment = self.total_capital * self.max_position_size
        return int(max_investment // stock_price)
    
    def check_stop_loss(self, entry_price: float, current_price: float) -> bool:
        """ì†ì ˆë§¤ ì²´í¬"""
        loss_percent = (entry_price - current_price) / entry_price
        return loss_percent >= self.stop_loss_percent
```
